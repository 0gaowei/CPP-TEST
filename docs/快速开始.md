# 测试快速开始指南（自研质量工具）

## 第一步：验证程序

在运行 Simple Quality Suite 之前，先确保程序可以正常编译和运行：

```bash
# 编译主程序
make

# 运行主程序（验证功能）
./calculator

# 编译测试程序
make test

# 运行测试程序（验证测试用例）
./calculator_test
```

如果以上命令都能正常执行，说明工程依赖齐备，即可使用 Simple Quality Suite 进行测试。

## 第二步：使用自研质量工具（Simple Quality Suite）

项目自带 `tools/simple_quality_suite.py`，支持**测试生成 → 测试执行 → 覆盖率统计 → 静态分析 → 报告导出**的一站式流程。

### 2.1 快速运行

```bash
python3 tools/simple_quality_suite.py
```

脚本会：

- 在 `tests/generated_tests.cpp` 生成/更新 199 个断言用例；
- 通过 `g++ -fprofile-arcs -ftest-coverage` 编译并执行计算器与测试程序；
- 使用 `gcov` 统计语句/分支/函数覆盖率；
- 调用 `cppcheck`（若缺失则回退到内置启发式扫描）进行静态分析；
- 汇总 JSON/HTML/XML 报告到 `reports/` 目录。

### 2.2 常用参数

```bash
# 只执行现有测试（跳过重新生成）
python3 tools/simple_quality_suite.py --skip-generate

# 只做静态分析
python3 tools/simple_quality_suite.py --skip-tests --skip-coverage

# 指定编译器
python3 tools/simple_quality_suite.py --compiler=clang++
```

更多选项可运行 `python3 tools/simple_quality_suite.py -h` 查看。

### 2.3 产物位置

| 文件/目录 | 含义 |
|-----------|------|
| `tests/generated_tests.cpp` | 自动生成的测试源代码 |
| `tests/generated_tests.json` | 生成用例的元数据（输入、期望值、随机种子） |
| `reports/tests/results.json` | 测试执行统计：总数、失败数、失败详情 |
| `reports/coverage/summary.json` | 语句/分支/函数覆盖率摘要 |
| `reports/coverage/*.gcov` | 针对各源文件的覆盖率标注 |
| `reports/static/static_analysis.json` | 静态分析输出（含使用的工具信息） |
| `reports/quality_summary.(html|xml)` | 适合归档的综合报告（默认被 `.gitignore` 忽略） |

这些结果即可直接作为测试证据，或填入测试报告模板。

## 第三步：填写测试报告

使用 `docs/测试报告模板.md`，从 `reports/` 目录提取数据填入：
1. 测试执行统计（来自 `reports/tests/results.json`）
2. 覆盖率数据（来自 `reports/coverage/summary.json`）
3. 静态分析结论（来自 `reports/static/static_analysis.json`）
4. 缺陷及改进建议

## 测试要点

1. **功能测试**：验证每个函数的基本功能
2. **边界测试**：测试边界值（0、负数、最大值等）
3. **异常测试**：测试异常情况（除零、负数阶乘等）
4. **覆盖率**：确保达到目标覆盖率（语句100%，分支95%以上）

## 项目文件说明

- `calculator.h/cpp` - 被测试的程序代码
- `CalculatorTest.cpp` - 人工维护的补充测试用例
- `Makefile` - 编译配置文件
- `docs/Makefile快速入门.md` - Makefile 使用指南
- `docs/测试报告模板.md` - 报告模板
- `tools/simple_quality_suite.py` - 自研质量工具
- `tools/generate_tests.py` - 测试生成核心脚本

祝测试顺利！

## 附录：脚本内部流程（可选阅读）

1. **测试生成**：调用 `tools/generate_tests.py` 基于随机种子与手工场景生成断言。
2. **构建与执行**：用 `g++` 生成带 `gcov` 插桩的可执行文件，运行并捕捉输出/退出码。
3. **覆盖率处理**：解析 `.gcda/.gcno`，整理为 JSON 与 `.gcov`，便于人工定位。
4. **静态分析**：优先运行 `cppcheck`，失败时 fallback 到启发式规则。
5. **报告整合**：将测试、覆盖率、静态分析结果汇总为 `quality_summary.(html|xml)`。

了解这些步骤有助于二次开发或对接 CI。

