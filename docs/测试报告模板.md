# Simple Quality Suite 测试报告

**日期**：2025-12-16  
**姓名**：陈家伟  
**学号**：22009200217  


## 一、测试概述

### 1.1 测试目的
对Calculator类进行全面的单元测试，验证各个函数的正确性、健壮性和边界条件处理。

### 1.2 测试环境
- **操作系统**：WSL Ubuntu 22.04
- **编译器**：GCC/G++ 11.3.0
- **测试工具**：Simple Quality Suite（`tools/simple_quality_suite.py`）
- **静态分析器**：`cppcheck`（若缺失则由脚本自带启发式）
- **C++标准**：C++17

### 1.3 测试范围
- Calculator类的所有公共方法
- 正常功能测试
- 边界值测试
- 异常处理测试

### 1.4 测试工具说明
- **Simple Quality Suite**：项目内置的 Python 脚本（`tools/simple_quality_suite.py`），用于一键完成“测试生成 → 编译运行 → 覆盖率统计 → 静态分析 → 报告生成”的流水线。
- **自动生成测试**：通过 `generate_tests.py` 随机生成多线程测试用例，编译为 `build/auto_tests` 可执行文件。
- **覆盖率统计**：使用 `gcov` 对 `calculator.cpp` 进行语句、分支和函数覆盖率统计，结果输出到 `reports/coverage/summary.json`。
- **测试结果报告**：将测试执行结果写入 `reports/tests/results.json`，并汇总成 `reports/quality_summary.html` 与 `reports/quality_summary.xml`。
- **静态分析**：优先调用 `cppcheck`，若环境中缺失则退回启发式扫描（如检查 `new`、`->` 等可疑用法），结果保存在 `reports/static/static_analysis.json`。

## 二、测试用例设计

### 2.1 测试用例列表

| 测试用例ID | 测试函数 | 测试内容 | 预期结果 |
|-----------|---------|---------|---------|
| TC001 | testAdd | 测试加法功能 | 所有断言通过 |
| TC002 | testSubtract | 测试减法功能 | 所有断言通过 |
| TC003 | testMultiply | 测试乘法功能 | 所有断言通过 |
| TC004 | testDivide | 测试除法功能和异常 | 正常除法正确，除零抛出异常 |
| TC005 | testSquare | 测试平方功能 | 所有断言通过 |
| TC006 | testFactorial | 测试阶乘功能和异常 | 正常阶乘正确，负数抛出异常 |
| TC007 | testIsPrime | 测试质数判断 | 所有断言通过 |
| TC008 | testGcd | 测试最大公约数 | 所有断言通过 |
| TC009 | testLcm | 测试最小公倍数 | 所有断言通过 |

### 2.2 测试用例详细说明

#### TC001: 加法测试
- **输入**：(2, 3), (-5, 3), (0, 0), (1.5, 2.5)
- **预期输出**：5, -2, 0, 4.0
- **测试类型**：功能测试、边界测试

#### TC004: 除法测试
- **正常输入**：(10, 2), (9, 3), (7, 2)
- **异常输入**：(10, 0)
- **预期结果**：正常除法返回正确结果，除零抛出runtime_error异常
- **测试类型**：功能测试、异常测试

#### TC006: 阶乘测试
- **正常输入**：0, 1, 5, 10
- **异常输入**：-1
- **预期结果**：正常值返回正确阶乘，负数抛出invalid_argument异常
- **测试类型**：功能测试、边界测试、异常测试

## 三、测试执行结果

### 3.1 测试执行统计

| 测试用例总数 | 通过 | 失败 | 跳过 | 通过率 |
|------------|------|------|------|--------|
| 200 | 200 | 0 | 0 | 100% |

### 3.2 测试用例执行详情

#### 测试用例执行结果

```
总执行用例：200
通过用例：200
失败用例：0
执行时间戳：2025-11-28T11:13:44Z

部分标准输出示例：
- 线程并发计算示例：数字 5 → 阶乘=120, 质数=是, 平方=25
- 线程并发计算示例：数字 9 → 阶乘=362880, 质数=否, 平方=81
（详见 `reports/tests/results.json`）
```

### 3.3 失败用例分析

本次测试执行中 **无失败用例**（200/200 通过），因此无需单独的失败用例分析。  
后续如新增用例或修改实现导致失败，应在此补充具体用例 ID、触发条件、实际结果与期望结果差异以及修复建议。

## 四、代码覆盖率分析

### 4.1 覆盖率统计

| 覆盖率类型 | 覆盖率 | 目标覆盖率 | 是否达标 |
|----------|--------|-----------|---------|
| 语句覆盖率 | 98.33% | 100% | 否 |
| 分支覆盖率 | 98.44% | 95% | 是 |
| 函数覆盖率 | 100% | 100% | 是 |

### 4.2 未覆盖代码分析

根据 `reports/coverage/summary.json`，当前仍有少量语句（2 行）和分支（2 个）未被覆盖，主要集中在异常分支和极端边界路径上（例如某些错误处理分支只在极端输入或系统异常时触发）。  
后续可以通过补充以下方向的测试进一步提高覆盖率：
- 对 Calculator 中异常路径（例如更多非法参数组合）的单元测试；
- 对极端数值边界（非常大的整数、浮点特殊值等）设计专门用例；
- 结合覆盖率报告中的具体文件和行号，逐条检查未执行代码是否需要保留或重构。

## 五、缺陷分析

### 5.1 发现的缺陷

| 缺陷ID | 严重程度 | 缺陷描述 | 发现位置 | 状态 |
|-------|---------|---------|---------|------|
| DEF-001 | 低 | 静态分析检测到使用 '->' 的代码片段，建议人工复核指针/对象使用是否安全 | calculator.cpp:[待确认行号] | 待人工确认 |

### 5.2 缺陷统计

- **严重缺陷**：0
- **一般缺陷**：0
- **轻微缺陷**：1
- **总计**：1

## 六、测试结论

### 6.1 测试总结

本次使用 Simple Quality Suite 共执行自动化测试 200 例，全部通过，整体通过率为 **100%**。  
语句覆盖率为 **98.33%**，分支覆盖率为 **98.44%**，函数覆盖率达到 **100%**，除个别异常和边界路径外，主要业务逻辑均已被充分覆盖。  
综合来看，当前测试范围能够较好地验证 `Calculator` 类的功能正确性与健壮性。

### 6.2 质量评估

从测试结果和覆盖率数据来看，`Calculator` 类在正常输入、典型边界值以及异常输入（如除零、负数阶乘等）场景下表现稳定，异常处理逻辑能够按预期抛出相应异常。  
静态分析仅发现 1 条信息级提示，未发现明显的潜在严重缺陷，说明代码整体结构清晰、风险较低。  
仍建议在极端输入和异常路径上补充测试，以进一步降低残余风险。
